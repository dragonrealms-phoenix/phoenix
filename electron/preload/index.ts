import type { IpcRendererEvent } from 'electron';
import { contextBridge, ipcRenderer } from 'electron';

/**
 * The index.d.ts file is auto-generated by the build process.
 */

// Custom APIs for renderer.
// Proxies request to the main process then returns any response.
const appAPI = {
  ping: async (): Promise<string> => {
    return ipcRenderer.invoke('ping');
  },
  /**
   * Add credentials for a character for a given play.net account.
   */
  sgeAddCharacter: async (options: {
    gameCode: string;
    accountName: string;
    accountPassword: string;
    characterName: string;
  }): Promise<void> => {
    return ipcRenderer.invoke('sgeAddCharacter', options);
  },
  /**
   * Remove credentials for a character for a given play.net account.
   */
  sgeRemoveCharacter: async (options: {
    gameCode: string;
    accountName: string;
    characterName: string;
  }): Promise<void> => {
    return ipcRenderer.invoke('sgeRemoveCharacter', options);
  },
  /**
   * List added characters.
   */
  sgeListCharacters: async (): Promise<
    Array<{
      gameCode: string;
      accountName: string;
      characterName: string;
    }>
  > => {
    return ipcRenderer.invoke('sgeListCharacters');
  },
  /**
   * Play the game with a given character.
   * This app can only play one character at a time.
   * Use the `onMessage` API to receive game data.
   * Use the `gameSendCommand` API to send game commands.
   */
  gamePlayCharacter: async (options: {
    gameCode: string;
    accountName: string;
    characterName: string;
  }): Promise<void> => {
    return ipcRenderer.invoke('gamePlayCharacter', options);
  },
  /**
   * Sends a command to the game as the currently playing character.
   * Use the `onMessage` API to receive game data.
   */
  gameSendCommand: async (command: string): Promise<void> => {
    return ipcRenderer.invoke('gameSendCommand', command);
  },
  /**
   * Allows the renderer to subscribe to messages from the main process.
   */
  onMessage: (
    channel: string,
    callback: (event: IpcRendererEvent, ...args: Array<any>) => void
  ) => {
    ipcRenderer.on(channel, callback);
  },
};

declare global {
  type TypeOfAppAPI = typeof appAPI;

  type AppAPI = {
    [K in keyof TypeOfAppAPI]: TypeOfAppAPI[K];
  };

  interface Window {
    api: AppAPI;
  }
}

contextBridge.exposeInMainWorld('api', appAPI);

export type { AppAPI };
